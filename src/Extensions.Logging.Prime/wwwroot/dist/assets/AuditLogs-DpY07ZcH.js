import{_ as le,y as ae,r as n,d as oe,c as m,b as a,k as s,h as o,o as f,a as b,t as u,i as I,z as ie,f as k,A as H}from"./index-BFdu6KXE.js";import{s as de}from"./index-WuoUu3WJ.js";import{s as ne,a as re,L as O,b as ue,c as ce}from"./LogService-Em5Sluby.js";import{s as ve}from"./index-D1iw5oeR.js";import"./index-DKgpYIyM.js";import"./request-C3Z5VieV.js";const pe={class:"card"},me={class:"flex justify-between"},fe={class:"flex justify-between gap-4"},ge={class:"flex justify-between gap-4"},be=["onClick"],_e={class:"limited-text"},xe={class:"p-4"},ye=["onClick"],we={class:"limited-text-150"},he={class:"flex items-center gap-4"},ke={key:0},Ce={key:0,class:"rounded flex flex-col"},Te={class:"flex justify-center rounded"},Pe={class:"relative mx-auto"},Le={key:0,class:"rounded flex flex-col"},Me={class:"flex justify-center rounded"},Se={class:"relative mx-auto"},Re={class:"mb-2"},Ae={class:"mb-2"},De={class:"mb-2"},Ee={class:"mb-2"},Ne={key:0,class:"mb-2"},Ve={__name:"AuditLogs",setup(ze){const C=ae(),A=n(),v=n(),c=n(),y=n(),_=n(!1),T=n(!1),P=n(),x=n(),L=n(),D=n(""),r=n(),E=n(),N=n(1),M=n(20),V=n(0),w=n(),g=n([]),F=()=>{w.value=v.value.reduce((t,e)=>(t[e.id]=!0)&&t,{}),g.value=v.value.map(t=>t.id)},K=()=>{g.value=[],w.value=null},Y=t=>{g.value.push(t.data.id)},q=t=>{g.value=g.value.filter(e=>e!=t.data.id)},G=t=>[{"!bg-primary !text-primary-contrast":g.value.indexOf(t.id)>-1}],z=t=>{switch(t){case 2:return"Delete";case 3:return"Update";case 4:return"Insert";default:return null}},h=t=>t.toLocaleString("zh-CN"),J=()=>{var t=c.value.map(e=>e.id);O.deleteAuditLogs(t).then(()=>{v.value=v.value.filter(e=>!c.value.includes(e)),_.value=!1,c.value=null,C.add({severity:"success",summary:"Successful",detail:"Logs Deleted",life:3e3})}).catch(e=>{var i,d;C.add({severity:"error",summary:"delete audit logs failed",detail:e.message+`\r
`+(((d=(i=e.response)==null?void 0:i.data)==null?void 0:d.message)??""),life:6e3})})},Q=()=>{_.value=!0},W=()=>{A.value.exportCSV()},X=t=>{r.value=t,T.value=!0},Z=(t,e,i)=>{var d;L.value.hide(),((d=r.value)==null?void 0:d.id)===e.id&&E.value===i?r.value=null:(E.value=i,D.value=e[i],r.value=e,H(()=>{L.value.show(t)}))},ee=(t,e)=>{var i;P.value.hide(),((i=x.value)==null?void 0:i.id)===e.id?x.value=null:(x.value=e,H(()=>{P.value.show(t)}))},te=t=>{N.value=t.page+1,M.value=t.rows,S()},S=()=>{y.value=!0,O.getAuditLogs(N.value,M.value).then(t=>{v.value=t.data,V.value=t.paging.totalCount,y.value=!1,v.value.forEach(e=>(e.startTime=new Date(e.startTime),e.endTime=new Date(e.endTime)))}).catch(t=>{y.value=!1,C.add({severity:"error",summary:"loading audit logs failed",detail:t.message,life:6e3})})};return oe(()=>{S()}),(t,e)=>{const i=ve,d=ue,U=ce,R=ne,$=re,j=de,B=ie;return f(),m("div",pe,[e[15]||(e[15]=a("div",{class:"font-semibold text-xl mb-4"},"Audit Logs",-1)),s(R,{ref_key:"dt",ref:A,selection:c.value,"onUpdate:selection":e[1]||(e[1]=l=>c.value=l),expandedRows:w.value,"onUpdate:expandedRows":e[2]||(e[2]=l=>w.value=l),value:v.value,loading:y.value,paginator:!0,rowsPerPageOptions:[10,20,50,100,200,500],rows:M.value,totalRecords:V.value,rowHover:!0,rowClass:G,lazy:!0,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} logs",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",dataKey:"id",resizableColumns:"",columnResizeMode:"fit",scrollable:"",scrollHeight:"580px",tableStyle:"min-width: 50rem",onPage:e[3]||(e[3]=l=>te(l)),onRowExpand:Y,onRowCollapse:q},{header:o(()=>[a("div",me,[a("span",fe,[s(i,{label:"Refresh",icon:"pi pi-refresh",onClick:S,outlined:""}),s(i,{label:"Delete",icon:"pi pi-trash",severity:"danger",outlined:"",onClick:Q,disabled:!c.value||!c.value.length},null,8,["disabled"]),s(i,{label:"Export",icon:"pi pi-upload",severity:"secondary",onClick:e[0]||(e[0]=l=>W(l))})]),a("span",ge,[s(i,{text:"",icon:"pi pi-plus",label:"Expand All",onClick:F}),s(i,{text:"",icon:"pi pi-minus",label:"Collapse All",onClick:K})])])]),empty:o(()=>e[7]||(e[7]=[b(" No data found. ")])),loading:o(()=>e[8]||(e[8]=[b(" Loading audit logs. Please wait. ")])),expansion:o(l=>[a("div",xe,[s(R,{value:l.data.entities,tableStyle:"max-width: 100%"},{default:o(()=>[s(d,{field:"state",header:"State"},{body:o(({data:p})=>[b(u(z(p.state)),1)]),_:1}),s(d,{field:"auditMessage",header:"AuditMessage"},{body:o(({data:p})=>[I((f(),m("div",{class:"flex items-center gap-2",onClick:se=>ee(se,p)},[a("span",we,u(p.auditMessage),1)],8,ye)),[[B,"click to view detail",void 0,{left:!0}]])]),_:1})]),_:2},1032,["value"])])]),default:o(()=>[s(d,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(d,{expander:"",style:{width:"5rem"}}),s(d,{exportable:!1},{body:o(({data:l})=>[s(i,{icon:"pi pi-search",onClick:p=>X(l),severity:"secondary",rounded:""},null,8,["onClick"])]),_:1}),s(d,{field:"userName",header:"UserName"}),s(d,{field:"startTime",header:"StartTime"},{body:o(({data:l})=>[b(u(h(l.startTime)),1)]),_:1}),s(d,{field:"endTime",header:"EndTime"},{body:o(({data:l})=>[b(u(h(l.endTime)),1)]),_:1}),s(d,{field:"succeeded",header:"Succeeded"},{body:o(({data:l})=>[s(U,{value:l.succeeded,severity:l.succeeded==!0?"success":"danger"},null,8,["value","severity"])]),_:1}),s(d,{field:"errorMessage",header:"ErrorMessage"},{body:o(({data:l})=>[I((f(),m("div",{class:"flex items-center gap-2",onClick:p=>Z(p,l,"errorMessage")},[a("span",_e,u(l.errorMessage),1)],8,be)),[[B,"click to view detail",void 0,{top:!0}]])]),_:1})]),_:1},8,["selection","expandedRows","value","loading","rows","totalRecords"]),s($,{visible:_.value,"onUpdate:visible":e[5]||(e[5]=l=>_.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:o(()=>[s(i,{label:"No",icon:"pi pi-times",text:"",onClick:e[4]||(e[4]=l=>_.value=!1)}),s(i,{label:"Yes",icon:"pi pi-check",text:"",onClick:J})]),default:o(()=>[a("div",he,[e[9]||(e[9]=a("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),c.value?(f(),m("span",ke,"Are you sure you want to delete the selected logs?")):k("",!0)])]),_:1},8,["visible"]),s(j,{ref_key:"msgPop",ref:L},{default:o(()=>[r.value?(f(),m("div",Ce,[a("div",Te,[a("div",Pe,[a("span",null,u(D.value),1)])])])):k("",!0)]),_:1},512),s(j,{ref_key:"auditMsgPop",ref:P},{default:o(()=>[x.value?(f(),m("div",Le,[a("div",Me,[a("div",Se,[a("span",null,u(x.value.auditMessage),1)])])])):k("",!0)]),_:1},512),s($,{visible:T.value,"onUpdate:visible":e[6]||(e[6]=l=>T.value=l),modal:"",maximizable:"",header:"Log Detail",style:{width:"65rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:o(()=>[a("div",Re,[e[10]||(e[10]=a("label",{class:"font-bold"},"[UserName]: ",-1)),a("span",null,u(r.value.userName),1)]),a("div",Ae,[e[11]||(e[11]=a("label",{class:"font-bold"},"[StartTime]: ",-1)),a("span",null,u(h(r.value.startTime)),1)]),a("div",De,[e[12]||(e[12]=a("label",{class:"font-bold"},"[EndTime]:",-1)),a("span",null,u(h(r.value.endTime)),1)]),a("div",Ee,[e[13]||(e[13]=a("label",{class:"font-bold"},"[Succeeded]:",-1)),s(U,{value:r.value.succeeded,severity:r.value.succeeded==!0?"success":"danger"},null,8,["value","severity"])]),r.value.succeeded?k("",!0):(f(),m("div",Ne,[e[14]||(e[14]=a("label",{class:"font-bold"},"[ErrorMessage]: ",-1)),a("span",null,u(r.value.errorMessage),1)])),s(R,{value:r.value.entities},{default:o(()=>[s(d,{field:"state",header:"State"},{body:o(({data:l})=>[b(u(z(l.state)),1)]),_:1}),s(d,{field:"auditMessage",header:"AuditMessage"})]),_:1},8,["value"])]),_:1},8,["visible"])])}}},Oe=le(Ve,[["__scopeId","data-v-41ad8fa1"]]);export{Oe as default};
