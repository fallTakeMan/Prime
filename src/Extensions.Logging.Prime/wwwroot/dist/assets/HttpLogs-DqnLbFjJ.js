import{_ as se,I as te,p as d,q as le,c as m,a as s,h as t,g as o,o as v,w as A,t as i,J as oe,F as ae,i as ne,b as ie,l as f,e as B,K as de}from"./index-CQGLhu-6.js";import{b as re}from"./index-y4K16fDf.js";import{s as ue,a as pe,L as j,b as ve,c as ce}from"./LogService-CFDrwnRU.js";import{s as me,a as fe,b as ge,c as be,d as _e,e as ye}from"./index-k9oIurea.js";import{s as he}from"./index-DP_7HvdA.js";import"./index-BQkXcjgv.js";import"./request-fA7VYk29.js";import"./index-B1FPxiK8.js";const xe={class:"card"},Ce={class:"flex justify-between"},we={class:"flex justify-between gap-4"},ke={class:"flex justify-between gap-4"},Te=["onClick"],Le={class:"limited-text"},Pe=["onClick"],Se={class:"limited-text"},Be={class:"mb-2"},He={class:"mb-2"},Re={class:"mb-2"},De={class:"mb-2"},qe={class:"mb-2"},Ie={class:"mb-2"},$e={class:"mb-2"},Ne={class:"mb-2"},Ve={class:"mb-2"},Me={class:"mb-2"},Ee={key:0,class:"mb-2"},Ue={class:"m-0"},ze={class:"m-0"},Ae={class:"m-0"},je={class:"m-0"},Fe={class:"flex items-center gap-4"},Ge={key:0},Ke={key:0,class:"rounded flex flex-col"},Oe={class:"flex justify-center rounded"},Qe={class:"relative mx-auto"},Je={__name:"HttpLogs",setup(Ye){const H=te(),R=d(),b=d(null),p=d(),a=d(),y=d(null),_=d(!1),w=d(!1),k=d(),D=d(""),q=d(),I=d(1),T=d(20),$=d(0),L=d([{field:"requestHeaders",header:"RequestHeaders"},{field:"responseHeaders",header:"ResponseHeaders"},{field:"ipAddress",header:"IpAddress"},{field:"connectionId",header:"ConnectionId"},{field:"traceId",header:"TraceId"},{field:"duration",header:"Duration"}]),P=d(L.value),F=n=>{P.value=L.value.filter(e=>n.includes(e))},G=()=>{_.value=!0},K=()=>{R.value.exportCSV()},O=n=>{a.value=n,w.value=!0},N=(n,e,r)=>{var c;k.value.hide(),((c=a.value)==null?void 0:c.id)===e.id&&q.value===r?a.value=null:(q.value=r,D.value=e[r],a.value=e,de(()=>{k.value.show(n)}))},S=()=>{y.value=!0,j.getHttpLogs(I.value,T.value).then(n=>{b.value=n.data,$.value=n.paging.totalCount,y.value=!1,b.value.forEach(e=>e.logTime=new Date(e.logTime))}).catch(n=>{y.value=!1,console.log(n)})},Q=n=>{I.value=n.page+1,T.value=n.rows,S()},J=()=>{var n=p.value.map(e=>e.id);j.deleteHttpLogs(n).then(()=>{b.value=b.value.filter(e=>!p.value.includes(e)),_.value=!1,p.value=null,H.add({severity:"success",summary:"Successful",detail:"Logs Deleted",life:3e3})}).catch(e=>{var r,c;H.add({severity:"error",summary:"Failed",detail:e.message+`\r
`+(((c=(r=e.response)==null?void 0:r.data)==null?void 0:c.message)??""),life:6e3})})},V=n=>n.toLocaleString("zh-CN"),M=n=>{switch(n){case"GET":return"info";case"POST":return"success";case"PUT":return"warn";case"DELETE":return"danger"}},E=n=>n>=400||n==0?"danger":"success";return le(()=>{S()}),(n,e)=>{const r=he,c=me,u=ve,h=ce,Y=ue,x=be,W=ge,C=ye,X=_e,Z=fe,U=pe,ee=re,z=oe;return v(),m("div",xe,[e[24]||(e[24]=s("div",{class:"font-semibold text-xl mb-4"},"Http Logs",-1)),t(Y,{ref_key:"dt",ref:R,selection:p.value,"onUpdate:selection":e[1]||(e[1]=l=>p.value=l),value:b.value,loading:y.value,paginator:!0,rows:T.value,rowsPerPageOptions:[10,20,50,100,200,500],totalRecords:$.value,lazy:!0,rowHover:!0,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} logs",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",dataKey:"id",resizableColumns:"",columnResizeMode:"fit",showGridlines:"",scrollable:"",scrollHeight:"560px",onPage:e[2]||(e[2]=l=>Q(l))},{header:o(()=>[s("div",Ce,[s("span",we,[t(r,{label:"Refresh",icon:"pi pi-refresh",onClick:S,outlined:""}),t(r,{label:"Delete",icon:"pi pi-trash",severity:"danger",outlined:"",onClick:G,disabled:!p.value||!p.value.length},null,8,["disabled"]),t(r,{label:"Export",icon:"pi pi-upload",severity:"secondary",onClick:e[0]||(e[0]=l=>K(l))})]),s("span",ke,[t(c,{modelValue:P.value,options:L.value,maxSelectedLabels:5,optionLabel:"header","onUpdate:modelValue":F,display:"chip",placeholder:"Select Columns"},null,8,["modelValue","options"])])])]),empty:o(()=>e[6]||(e[6]=[f(" No data found. ")])),loading:o(()=>e[7]||(e[7]=[f(" Loading http logs. Please wait. ")])),default:o(()=>[t(u,{selectionMode:"multiple",headerStyle:"width: 3rem"}),t(u,{exportable:!1},{body:o(({data:l})=>[t(r,{icon:"pi pi-search",onClick:g=>O(l),severity:"secondary",rounded:""},null,8,["onClick"])]),_:1}),t(u,{field:"method",header:"Method"},{body:o(({data:l})=>[t(h,{value:l.method,severity:M(l.method)},null,8,["value","severity"])]),_:1}),t(u,{field:"statusCode",header:"StatusCode"},{body:o(({data:l})=>[t(h,{value:l.statusCode,severity:E(l.statusCode)},null,8,["value","severity"])]),_:1}),t(u,{field:"host",header:"Host"}),t(u,{field:"path",header:"Path"}),t(u,{field:"queryString",header:"QueryString"}),t(u,{field:"requestBody",header:"RequestBody"},{body:o(({data:l})=>[A((v(),m("div",{class:"flex items-center gap-2",onClick:g=>N(g,l,"requestBody")},[s("span",Le,i(l.requestBody),1)],8,Te)),[[z,"click to view detail",void 0,{top:!0}]])]),_:1}),t(u,{field:"responseBody",header:"ResponseBody"},{body:o(({data:l})=>[A((v(),m("div",{class:"flex items-center gap-2",onClick:g=>N(g,l,"responseBody")},[s("span",Se,i(l.responseBody),1)],8,Pe)),[[z,"click to view detail",void 0,{top:!0}]])]),_:1}),(v(!0),m(ae,null,ne(P.value,(l,g)=>(v(),ie(u,{field:l.field,header:l.header,key:l.field+"_"+g,style:{"max-width":"20rem"}},null,8,["field","header"]))),128)),t(u,{field:"logTime",header:"LogTime"},{body:o(({data:l})=>[f(i(V(l.logTime)),1)]),_:1}),t(u,{field:"userName",header:"UserName"})]),_:1},8,["selection","value","loading","rows","totalRecords"]),t(U,{visible:w.value,"onUpdate:visible":e[3]||(e[3]=l=>w.value=l),modal:"",maximizable:"",header:"Log Detail",style:{width:"65rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:o(()=>[s("div",null,[s("div",Be,[e[8]||(e[8]=s("label",{class:"font-bold"},"[Method]: ",-1)),t(h,{value:a.value.method,severity:M(a.value.method)},null,8,["value","severity"])]),s("div",He,[e[9]||(e[9]=s("label",{class:"font-bold"},"[StatusCode]: ",-1)),t(h,{value:a.value.statusCode,severity:E(a.value.statusCode)},null,8,["value","severity"])]),s("div",Re,[e[10]||(e[10]=s("label",{class:"font-bold"},"[Host]: ",-1)),s("span",null,i(a.value.host),1)]),s("div",De,[e[11]||(e[11]=s("label",{class:"font-bold"},"[Path]: ",-1)),s("span",null,i(a.value.path),1)]),s("div",qe,[e[12]||(e[12]=s("label",{class:"font-bold"},"[QueryString]: ",-1)),s("span",null,i(a.value.queryString),1)]),s("div",Ie,[e[13]||(e[13]=s("label",{class:"font-bold"},"[IpAddress]: ",-1)),s("span",null,i(a.value.ipAddress),1)]),s("div",$e,[e[14]||(e[14]=s("label",{class:"font-bold"},"[ConnectionId]: ",-1)),s("span",null,i(a.value.connectionId),1)]),s("div",Ne,[e[15]||(e[15]=s("label",{class:"font-bold"},"[TraceId]: ",-1)),s("span",null,i(a.value.traceId),1)]),s("div",Ve,[e[16]||(e[16]=s("label",{class:"font-bold"},"[Duration]: ",-1)),s("span",null,i(a.value.duration),1)]),s("div",Me,[e[17]||(e[17]=s("label",{class:"font-bold"},"[LogTime]: ",-1)),s("span",null,i(V(a.value.logTime)),1)]),a.value.userName?(v(),m("div",Ee,[e[18]||(e[18]=s("label",{class:"font-bold"},"[UserName]: ",-1)),s("span",null,i(a.value.userName),1)])):B("",!0),t(Z,{value:"0"},{default:o(()=>[t(W,null,{default:o(()=>[t(x,{value:"0"},{default:o(()=>e[19]||(e[19]=[f("RequestBody")])),_:1}),t(x,{value:"1"},{default:o(()=>e[20]||(e[20]=[f("RequestHeaders")])),_:1}),t(x,{value:"2"},{default:o(()=>e[21]||(e[21]=[f("ResponseBody")])),_:1}),t(x,{value:"3"},{default:o(()=>e[22]||(e[22]=[f("ResponseHeaders")])),_:1})]),_:1}),t(X,null,{default:o(()=>[t(C,{value:"0"},{default:o(()=>[s("p",Ue,i(a.value.requestBody),1)]),_:1}),t(C,{value:"1"},{default:o(()=>[s("p",ze,i(a.value.requestHeaders),1)]),_:1}),t(C,{value:"2"},{default:o(()=>[s("p",Ae,i(a.value.responseBody),1)]),_:1}),t(C,{value:"3"},{default:o(()=>[s("p",je,i(a.value.responseHeaders),1)]),_:1})]),_:1})]),_:1})])]),_:1},8,["visible"]),t(U,{visible:_.value,"onUpdate:visible":e[5]||(e[5]=l=>_.value=l),modal:"",header:"Confirm",style:{width:"450px"}},{footer:o(()=>[t(r,{label:"No",icon:"pi pi-times",text:"",onClick:e[4]||(e[4]=l=>_.value=!1)}),t(r,{label:"Yes",icon:"pi pi-check",text:"",onClick:J})]),default:o(()=>[s("div",Fe,[e[23]||(e[23]=s("i",{class:"pi pi-exclamation-triangle !text-3xl"},null,-1)),p.value?(v(),m("span",Ge,"Are you sure you want to delete the selected logs?")):B("",!0)])]),_:1},8,["visible"]),t(ee,{ref_key:"msgPop",ref:k},{default:o(()=>[a.value?(v(),m("div",Ke,[s("div",Oe,[s("div",Qe,[s("span",null,i(D.value),1)])])])):B("",!0)]),_:1},512)])}}},as=se(Je,[["__scopeId","data-v-f870388d"]]);export{as as default};
